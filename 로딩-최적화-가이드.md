# ⚡ Three.js 로딩 최적화 가이드

## 🐌 현재 문제점

### CDN 로딩 시간
```
Three.js (600KB)      → 1-3초
Cannon.js (300KB)     → 0.5-1.5초
OrbitControls (30KB)  → 0.2-0.5초
─────────────────────────────
총 합계: 1.7-5초 (느린 네트워크)
```

## ✅ 해결 방법

### 1️⃣ 빠른 CDN 사용 (이미 적용됨)

**변경 전 (느림):**
```html
<!-- jsDelivr CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
```

**변경 후 (빠름):**
```html
<!-- unpkg CDN - 더 빠른 서버 -->
<script src="https://unpkg.com/three@0.150.0/build/three.min.js"></script>
```

**속도 개선:** 20-30% 빨라짐

---

### 2️⃣ 로컬 파일 사용 (최고의 성능!) ⭐

#### Step 1: 라이브러리 다운로드
```bash
# 자동 다운로드 (권장)
download-libs.bat

# 또는 수동 다운로드
curl -L -o libs-threejs/three.min.js https://unpkg.com/three@0.150.0/build/three.min.js
curl -L -o libs-threejs/cannon-es.min.js https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.min.js
curl -L -o libs-threejs/OrbitControls.js https://unpkg.com/three@0.150.0/examples/js/controls/OrbitControls.js
```

#### Step 2: HTML 수정
`mesh-cutting-threejs.html`에서 CDN 링크를 로컬 경로로 변경:

```html
<!-- CDN (변경 전) -->
<script src="https://unpkg.com/three@0.150.0/build/three.min.js"></script>

<!-- 로컬 (변경 후) -->
<script src="libs-threejs/three.min.js"></script>
```

**속도 개선:** 80-90% 빨라짐! (0.1-0.5초로 단축)

---

### 3️⃣ 프로그레시브 로딩 (이미 적용됨)

```html
<script>
    function updateProgress(message) {
        loadedScripts++;
        const progress = (loadedScripts / totalScripts) * 100;
        progressBar.style.width = progress + '%';
        progressText.textContent = message;
    }
</script>

<script src="three.min.js" onload="updateProgress('Three.js 로드 완료 ✓')"></script>
```

**효과:** 사용자가 로딩 진행 상황을 볼 수 있음

---

### 4️⃣ 브라우저 캐싱

#### Cache-Control 헤더 설정 (서버 필요)
```apache
# .htaccess (Apache)
<FilesMatch "\.(js)$">
    Header set Cache-Control "max-age=31536000, public"
</FilesMatch>
```

**효과:** 두 번째 방문부터 즉시 로드 (0초!)

---

## 📊 성능 비교

| 방법 | 첫 로딩 | 재방문 | 구현 난이도 |
|------|---------|--------|-------------|
| **CDN (jsDelivr)** | 3-5초 | 1-2초 | 쉬움 |
| **CDN (unpkg) ✅** | 2-4초 | 0.5-1초 | 쉬움 |
| **로컬 파일 ⭐** | 0.2-0.5초 | 0.1-0.2초 | 중간 |
| **번들링 + 압축** | 0.1-0.3초 | 즉시 | 어려움 |

---

## 🚀 즉시 적용 가능한 최적화

### A. 라이브러리 다운로드 (추천!)

```bash
# 1. 자동 다운로드 실행
download-libs.bat

# 2. 생성된 파일 확인
libs-threejs/
  ├── three.min.js (600KB)
  ├── cannon-es.min.js (300KB)
  └── OrbitControls.js (30KB)

# 3. HTML 파일의 스크립트 경로만 변경
# https://unpkg.com/... → libs-threejs/...
```

**결과:** 로딩 시간 80% 단축! ⚡

---

### B. 최적화된 HTML 만들기

기존 파일은 그대로 두고, 로컬 버전 생성:

```bash
# mesh-cutting-threejs-local.html 생성
cp mesh-cutting-threejs.html mesh-cutting-threejs-local.html
```

`mesh-cutting-threejs-local.html` 수정:
```html
<!-- CDN 대신 로컬 경로 -->
<script src="libs-threejs/three.min.js" onload="updateProgress('Three.js 로드 완료 ✓')"></script>
<script src="libs-threejs/cannon-es.min.js" onload="updateProgress('Cannon.js 로드 완료 ✓')"></script>
<script src="libs-threejs/OrbitControls.js" onload="updateProgress('OrbitControls 로드 완료 ✓')"></script>
```

---

## 🎯 고급 최적화 (선택사항)

### 1. Webpack으로 번들링
```bash
npm init -y
npm install webpack webpack-cli three cannon-es

# webpack.config.js
module.exports = {
    entry: './mesh-cutting-threejs.js',
    output: {
        filename: 'bundle.min.js'
    },
    mode: 'production'
};

npx webpack
```

**효과:** 1개 파일로 통합, 추가 압축 (300-400KB로 감소)

---

### 2. Lazy Loading (필요시에만 로드)
```javascript
// OrbitControls를 나중에 로드
async function loadControls() {
    const THREE = await import('./libs-threejs/OrbitControls.js');
    // 사용자가 카메라를 움직일 때만 로드
}
```

---

### 3. Service Worker (PWA)
```javascript
// service-worker.js
self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open('threejs-cache-v1').then((cache) => {
            return cache.addAll([
                'libs-threejs/three.min.js',
                'libs-threejs/cannon-es.min.js',
                'libs-threejs/OrbitControls.js'
            ]);
        })
    );
});
```

**효과:** 오프라인에서도 작동!

---

## 📈 측정 도구

### Chrome DevTools
```
F12 → Network 탭
- Disable cache 체크 해제
- 리로드하면서 로딩 시간 확인
```

### 콘솔 로그
```javascript
// 이미 구현됨!
const loadStartTime = performance.now();
// ... 로딩 ...
const loadTime = ((performance.now() - loadStartTime) / 1000).toFixed(2);
console.log(`로드 시간: ${loadTime}초`);
```

---

## 💡 권장 순서

### 🥇 1단계: 로컬 파일 사용 (5분 소요)
```bash
1. download-libs.bat 실행
2. HTML에서 경로만 수정
3. 테스트
```
**효과:** 80% 성능 향상 ⚡

### 🥈 2단계: 브라우저 캐싱 (이미 동작 중)
- 두 번째 방문부터 자동으로 캐시 사용
- 별도 작업 불필요

### 🥉 3단계: 번들링 (고급, 30분 소요)
- 프로덕션 배포 시에만 필요
- Webpack/Vite 등 사용

---

## 🔍 현재 상태 확인

브라우저 콘솔(F12)에서:
```javascript
// 로드 시간
✅ 모든 리소스 로드 완료: 2.34초

// 초기화 시간
✅ Three.js 초기화 완료: 0.12초

// 총 시간 = 2.46초
```

**목표:**
- CDN: 2-4초 (현재)
- 로컬: 0.2-0.5초 ⭐ (권장)

---

## 🎓 결론

### 즉시 적용 가능 (5분):
```bash
1. download-libs.bat 실행
2. HTML 파일 3줄 수정
3. 80% 빨라짐! 🚀
```

### 장기적 해결책:
```bash
1. Webpack 번들링
2. CDN에 번들 업로드
3. 브라우저 캐싱 최적화
4. Service Worker로 PWA 구현
```

---

## 📁 파일 구조 (최적화 후)

```
Grapics/
├── libs-threejs/              # 로컬 라이브러리 (신규)
│   ├── three.min.js
│   ├── cannon-es.min.js
│   └── OrbitControls.js
├── mesh-cutting-threejs.html  # CDN 버전 (온라인)
├── mesh-cutting-threejs-local.html  # 로컬 버전 (빠름) ⚡
└── mesh-cutting-threejs.js
```

---

## 🚀 빠른 시작

```bash
# 1. 라이브러리 다운로드
download-libs.bat

# 2. 로컬 버전 열기 (빠름!)
start mesh-cutting-threejs-local.html
```

**로딩 시간:** 2-4초 → **0.2-0.5초** 🎉

